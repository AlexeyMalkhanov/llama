<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Sep 24, 2013 -->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Llama, Running</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
        <meta name="Date-Revision-yyyymmdd" content="20130924" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      </head>
  <body class="composite">
    <div id="banner">
                  <span id="bannerLeft">
                Llama
                </span>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                                <div class="xleft">
        Last Published: 2013-09-24
                  &nbsp;| Version: 1.0.0-cdh5.0.0-SNAPSHOT
                      </div>
            <div class="xright">            <a href="http://www.cloudera.com/" class="externalLink">Cloudera Inc.</a>
              
                      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                                                <h5>Llama</h5>
                  <ul>
                  <li class="none">
                  <a href="index.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="Llama.thrift">Thrift Definition</a>
            </li>
                  <li class="none">
                  <a href="BuildingLlama.html">Building Llama</a>
            </li>
                  <li class="none">
                  <a href="TestingWithLlama.html">Testing with Llama</a>
            </li>
                  <li class="none">
            <strong>Running Llama</strong>
          </li>
                  <li class="none">
                  <a href="llama-site.html">LlamaAM Configuration</a>
            </li>
          </ul>
                                 <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
          <img alt="Built by Maven" src="./images/logos/maven-feather.png"/>
        </a>
                       
                            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!-- Licensed under the Apache License, Version 2.0 (the "License"); --><!-- you may not use this file except in compliance with the License. --><!-- You may obtain a copy of the License at --><!--  --><!-- http://www.apache.org/licenses/LICENSE-2.0 --><!--  --><!-- Unless required by applicable law or agreed to in writing, software --><!-- distributed under the License is distributed on an "AS IS" BASIS, --><!-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. --><!-- See the License for the specific language governing permissions and --><!-- limitations under the License. --><div class="section"><h2>Running Llama<a name="Running_Llama"></a></h2><ul><li><a href="#Llama_Application_Master">Llama Application Master</a><ul><li><a href="#Install_Llama_AM">Install Llama AM</a></li><li><a href="#Llama_AM_Configuration">Llama AM Configuration</a></li><li><a href="#Hadoop_Yarn_Configuration_for_Llama_AM_Required">Hadoop Yarn Configuration for Llama AM (Required)</a></li><li><a href="#Run_Llama_AM">Run Llama AM</a></li><li><a href="#Security_Configuration_for_Llama_AM">Security Configuration for Llama AM</a></li><li><a href="#Authorization_Configuration_for_Llama_AM">Authorization Configuration for Llama AM</a></li><li><a href="#HTTP_JSON_JMX_Endpoint">HTTP JSON JMX Endpoint</a></li><li><a href="#Gang_Scheduling_Anti-Deadlock_Detection">Gang Scheduling Anti-Deadlock Detection</a></li></ul></li><li><a href="#Llama_Node_Manager_Auxiliary_Service">Llama Node Manager Auxiliary Service</a><ul><li><a href="#Install_Llama_NM_Auxiliary_Service">Install Llama NM Auxiliary Service</a></li><li><a href="#Llama_NM_Auxiliary_Service_Configuration">Llama NM Auxiliary Service Configuration</a></li><li><a href="#Hadoop_Yarn_Configuration_for_Llama_NM_Auxiliary_Service_Required">Hadoop Yarn Configuration for Llama NM Auxiliary Service (Required)</a></li><li><a href="#Security_Configuration_for_Llama_NM_Auxiliary_Service">Security Configuration for Llama NM Auxiliary Service</a></li><li><a href="#Authorization_Configuration_for_Llama_NM_Auxiliary_Service">Authorization Configuration for Llama NM Auxiliary Service</a></li></ul></li><li><a href="#Notes_on_Thrift">Notes on Thrift</a></li></ul><div class="section"><h3>Llama Application Master<a name="Llama_Application_Master"></a></h3><div class="section"><h4>Install Llama AM<a name="Install_Llama_AM"></a></h4><p>Build or download, and expand the Llama distribution tarball, <tt>llama-1.0.0-cdh5.0.0-SNAPSHOT.tar.gz</tt>.</p><p>Llama requires a local Hadoop client installed and configured to access the Hadoop cluster. </p></div><div class="section"><h4>Llama AM Configuration<a name="Llama_AM_Configuration"></a></h4><p>Within Llama AM root directory:</p><ul><li>Llama AM startup configuration: <tt>libexec/llama-env.sh</tt>.</li><li>Llama AM server configuration: <tt><a href="./llama-site.html">conf/llama-site.xml</a></tt> (changes take effect on re-start).</li><li>Llama AM server logging: <tt><a href="./llama-log4j.properties">conf/llama-log4j.properties</a></tt> (changes take effect within 1 second).</li></ul><p><b>NOTE:</b> These files have all configuration properties with their default values.</p></div><div class="section"><h4>Hadoop Yarn Configuration for Llama AM (Required)<a name="Hadoop_Yarn_Configuration_for_Llama_AM_Required"></a></h4><p>The user running LlamaAM must be configured in Hadoop as a proxy user for itself.</p><p>Without Hadoop security enabled, the user running the LlamaAM server is Unix user starting the LlamaAM server.</p><p>With Hadoop security enabled, the user running the LlamaAM server is the short name of the Kerberos Principal used by the LlamaAM server (i.e. for a <tt>llama/HOSTNAME</tt> Kerberos principal, the short name is <tt>llama</tt>).</p><p>Hadoop's <tt>core-site.xml</tt> must include the following 2 configuration properties:</p><div class="source"><pre>  &lt;property&gt;
    &lt;name&gt;hadoop.proxyuser.#LLAMAUSER#.hosts&lt;/name&gt;
    &lt;value&gt;#HOSTNAME_RUNNING_LLAMA#&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;hadoop.proxyuser.#LLAMAUSER#.groups&lt;/name&gt;
    &lt;value&gt;#GROUP_LLAMA_USER_BELONGS_TO#&lt;/value&gt;
  &lt;/property&gt;</pre></div><p>For example if the user running the LlamaAM server is <tt>llama</tt>, the LlamaAM server is running in host <tt>foo.com</tt> and the <tt>llama</tt> user belongs to the <tt>llamagroup</tt> group, the 2 configuration properties would be:</p><div class="source"><pre>  &lt;property&gt;
    &lt;name&gt;hadoop.proxyuser.llama.hosts&lt;/name&gt;
    &lt;value&gt;foo.com&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;hadoop.proxyuser.llama.groups&lt;/name&gt;
    &lt;value&gt;llamagroup&lt;/value&gt;
  &lt;/property&gt;</pre></div><p><b>NOTE:</b> For development and testing, if the values are set to <tt>*</tt> the LlamaAM server can be running from any host and there is no need to create a <tt>llamagroup</tt>.</p></div><div class="section"><h4>Run Llama AM<a name="Run_Llama_AM"></a></h4><p>To start Llama:</p><div class="source"><pre>$ bin/llama
2013-08-02 06:57:32,743 INFO  Main - -----------------------------------------------------------------
2013-08-02 06:57:32,746 INFO  Main -   Java runtime version : 1.6.0_51-b11-457-11M4509
2013-08-02 06:57:32,747 INFO  Main -   Llama version        : 1.0.0-cdh5.0.0-SNAPSHOT
2013-08-02 06:57:32,747 INFO  Main -   Llama built date     : 2013-08-02T13:43Z
2013-08-02 06:57:32,747 INFO  Main -   Llama built by       : tucu
2013-08-02 06:57:32,747 INFO  Main -   Llama revision       : ba875da60c9865cceb70c352eb062f4fd1dfa309
2013-08-02 06:57:32,784 INFO  Main -   Hadoop version       : 2.1.0-cdh5.0.0-SNAPSHOT
2013-08-02 06:57:32,784 INFO  Main - -----------------------------------------------------------------
2013-08-02 06:57:32,784 INFO  Main - Configuration directory: /Users/tucu/llama/conf
2013-08-02 06:57:32,878 INFO  Main - Server: com.cloudera.llama.am.LlamaAMServer
2013-08-02 06:57:32,879 INFO  Main - -----------------------------------------------------------------
2013-08-02 06:57:33,790 INFO  LlamaAMThriftServer - Server listening on: 0.0.0.0:15000
2013-08-02 06:57:33,790 INFO  LlamaAMThriftServer - Llama started!</pre></div><p>Llama will run in the foreground.</p><p>To stop Llama do a <tt>CTRL-C</tt> on the terminal running llama or do a <tt>kill</tt> on the PID, Llama will shutdown gracefully on a <tt>SIGINT</tt>:</p><div class="source"><pre>...
2013-08-02 07:06:28,434 INFO  LlamaAMThriftServer - Llama started!
^C
2013-08-02 07:06:29,653 INFO  LlamaAMThriftServer - Llama shutdown!
$</pre></div></div><div class="section"><h4>Security Configuration for Llama AM<a name="Security_Configuration_for_Llama_AM"></a></h4><p>If configuring Llama AM with security Enabled (Thrift with Kerberos SASL) you need a running KDC, a service keytab (<tt>llama/HOSTNAME</tt>) and the corresponding keytab file.</p><p>The properties to configure in the <tt>llama-site.xml</tt> file are (shown with default values):</p><ul><li>llama.am.server.thrift.security=false</li><li>llama.am.server.thrift.kerberos.keytab.file=llama.keytab</li><li>llama.am.server.thrift.kerberos.server.principal.name=llama/_HOST</li><li>llama.am.server.thrift.kerberos.notification.principal.name=impala</li></ul><p>The <tt>_HOST</tt> in the principal name gets resolved to the canonical hostname of the machine where LlamaAM is running. To avoid misconfiguration problems, use the actual hostname instead <tt>_HOST</tt>. The hostname used should match the hostname the server address resolves to. The server address is set in the <tt>llama.am.server.thrift.address</tt> configuration property (the port number will be ignored if present). </p><p><b>IMPORTANT:</b> the default server address is <tt>0.0.0.0</tt>, if enabling security the address should be changed to a fixed IP or (better) a hostname. If set to a fixed IP, the hostname that IP resolves to must match the hostname in the Kerberos service principal.</p><p>If the path specified in <tt>llama.am.server.thrift.kerberos.keytab.file</tt> is a relative path, the keytab file will be expected in the Llama configuration directory.</p><p>When specifying the principal names use the short name only, do not include the service hostname. The Thrift SASL implementation composes the complete service principal name (<tt>shortName</tt>/<tt>hostname</tt>).</p></div><div class="section"><h4>Authorization Configuration for Llama AM<a name="Authorization_Configuration_for_Llama_AM"></a></h4><p><b>IMPORTANT:</b> Authorization is only active when security is enabled.</p><p>Llama supports Access Control Lists (ACL) to restrict client and admin access.</p><p>And ACL is either the <b>*</b> wildcard or a comma-separated list of users and groups. Users are separated from groups by a whitespace.</p><p>There are 2 ACL configuration properties, <b>client</b> and <b>admin</b>. The <b>client</b> ACL is applied to calls in the regular thrift service endpoint. The <b>admin</b> ACL is applied to calls in the admin thrift service endpoint.</p><p>ACL are defined in the <tt>llama-site.xml</tt> configuration file. The ACL configuration properties and their default values are:</p><ul><li><tt>llama.am.server.thrift.client.acl=*</tt></li><li><tt>llama.am.server.thrift.admin.acl=*</tt></li></ul><p>Llama uses Hadoop's <tt>Groups</tt> class to retrieve user group information. The configuration for the <tt>Groups</tt> class must be set in the <tt>llama-site.xml</tt> configuration file, the default values are:</p><ul><li><tt>hadoop.security.group.mapping=org.apache.hadoop.security.ShellBasedUnixGroupsMapping</tt></li><li><tt>hadoop.security.groups.cache.secs=300</tt></li></ul><p>For alternate group.mapping implementations and their configuration refer to the Hadoop documentation.</p></div><div class="section"><h4>HTTP JSON JMX Endpoint<a name="HTTP_JSON_JMX_Endpoint"></a></h4><p>Llama AM exposes a HTTP JSON JMX endpoint (it uses Hadoop's HTTP JSON JMX servlet).</p><p>The <tt>llama.am.server.thrift.http.jmx.address</tt> configuration property defines the address the JMX servlet is bound to, by default is <tt>0.0.0.0:15001</tt>.</p><p>The JMX servlet is available at <tt>/jmx</tt>, for example <tt>http://localhost:15001/jmx</tt>.</p></div><div class="section"><h4>Gang Scheduling Anti-Deadlock Detection<a name="Gang_Scheduling_Anti-Deadlock_Detection"></a></h4><p>Llama implements client side gang scheduling by waiting for all resources of a gang reservation to be granted before notifying Impala.</p><p>To avoid deadlocks among multiple reservations waiting for resources held by each other, Llama implements the following anti-deadlock logic. If no new resources are allocated for all gang reservations in a configured amount of time, a back off policy is triggered. The backoff policy will transparently cancel random gang reservations until a configured percentage of canceled resources is reached. The canceled reservations will be backed off for a random delay between a configured minimum and maximum delay. Once the random elapses, the reservation will be automatically submitted.</p><p>The anti-deadlock detection logic is completely transparent to Llama clients.</p><p>The Llama configuration properties for anti-deadlock detection and their default values are</p><ul><li>llama.am.gang.anti.deadlock.enabled = true</li><li>llama.am.gang.anti.deadlock.no.allocation.limit.ms = 30000</li><li>llama.am.gang.anti.deadlock.backoff.percent = 30</li><li>llama.am.gang.anti.deadlock.backoff.min.delay.ms = 10000</li><li>llama.am.gang.anti.deadlock.backoff.max.delay.ms = 30000</li></ul></div></div><div class="section"><h3>Llama Node Manager Auxiliary Service<a name="Llama_Node_Manager_Auxiliary_Service"></a></h3><div class="section"><h4>Install Llama NM Auxiliary Service<a name="Install_Llama_NM_Auxiliary_Service"></a></h4><p>Expand the Llama TARBALL distribution file.</p><p>The Llama installation has a <tt>lib/</tt> directory. The JARs within this directory must be added to the classpath of all NodeManagers in the Yarn cluster.</p><p>When configure, the Llama NM auxiliary service is started and stopped by the Hadoop Yarn NodeManager services when they start and stop.</p></div><div class="section"><h4>Llama NM Auxiliary Service Configuration<a name="Llama_NM_Auxiliary_Service_Configuration"></a></h4><p>Llama NM auxiliary service configuration file, <tt>llama-site.xml</tt>, must be copied to the NodeManager configuration directory.</p><p>Any changes to the <tt>llama-site.xml</tt> file take effect on re-start.</p></div><div class="section"><h4>Hadoop Yarn Configuration for Llama NM Auxiliary Service (Required)<a name="Hadoop_Yarn_Configuration_for_Llama_NM_Auxiliary_Service_Required"></a></h4><p>The following properties must be set in all NodeManager <tt>yarn-site.xml</tt> configuration files:</p><div class="source"><pre>    &lt;property&gt;
      &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;
      &lt;value&gt;mapreduce.shuffle,llama.nm.plugin&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
      &lt;name&gt;yarn.nodemanager.aux-services.llama.nm.plugin.class&lt;/name&gt;
      &lt;value&gt;com.cloudera.llama.nm.LlamaNMAuxiliaryService&lt;/value&gt;
    &lt;/property&gt;</pre></div><p><b>NOTE:</b> The <tt>mapreduce.shuffle</tt> value is not required by Llama NM auxiliary service but for Map-Reduce to work in Yarn.</p></div><div class="section"><h4>Security Configuration for Llama NM Auxiliary Service<a name="Security_Configuration_for_Llama_NM_Auxiliary_Service"></a></h4><p>The security configuration for Llama NM auxiliary service is identical to Llama AM security configuration (see above). The only difference is that the property names have <b>.nm.</b> instead of <tt>.am.</tt>:</p><ul><li>llama.nm.server.thrift.security=false</li><li>llama.nm.server.thrift.kerberos.keytab.file=llama.keytab</li><li>llama.nm.server.thrift.kerberos.server.principal.name=llama/_HOST</li><li>llama.nm.server.thrift.kerberos.notification.principal.name=impala</li></ul></div><div class="section"><h4>Authorization Configuration for Llama NM Auxiliary Service<a name="Authorization_Configuration_for_Llama_NM_Auxiliary_Service"></a></h4><p><b>IMPORTANT:</b> Authorization is only active when security is enabled.</p><p>Llama supports Access Control Lists (ACL) to restrict client and admin access.</p><p>And ACL is either the <b>*</b> wildcard or a comma-separated list of users and groups. Users are separated from groups by a whitespace.</p><p>There are 2 ACL configuration properties, <b>client</b> and <b>admin</b>. The <b>client</b> ACL is applied to calls in the regular thrift service endpoint. The <b>admin</b> ACL is applied to calls in the admin thrift service endpoint.</p><p>ACL are defined in the <tt>llama-site.xml</tt> configuration file. The ACL configuration properties and their default values are:</p><ul><li><tt>llama.nm.server.thrift.client.acl=*</tt></li><li><tt>llama.nm.server.thrift.admin.acl=*</tt></li></ul><p>Llama uses Hadoop's <tt>Groups</tt> class to retrieve user group information. The configuration for the <tt>Groups</tt> class must be set in the <tt>llama-site.xml</tt> configuration file, the default values are:</p><ul><li><tt>hadoop.security.group.mapping=org.apache.hadoop.security.ShellBasedUnixGroupsMapping</tt></li><li><tt>hadoop.security.groups.cache.secs=300</tt></li></ul><p>For alternate group.mapping implementations and their configuration refer to the Hadoop documentation.</p></div></div><div class="section"><h3>Notes on Thrift<a name="Notes_on_Thrift"></a></h3><p>Llama Thrift server supports unframed transport only (per Impala requirement). Because of this Llama must use synchronous IO (<tt>TThreadPoolServer</tt>).</p><p>Kerberos Thrift SASL is supported.</p></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;            2013
              Cloudera Inc
            
                       - <a href="http://maven.apache.org/privacy-policy.html">Privacy Policy</a></div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
